---
import type { Page } from "astro";

interface Props {
  page: Page<any>;
}

const { page } = Astro.props;

// 处理大量页码的显示逻辑
const getVisiblePages = (current: number, total: number) => {
  if (total <= 7) return [...Array(total)].map((_, i) => i + 1);

  if (current <= 3) return [1, 2, 3, 4, null, total];
  if (current >= total - 2)
    return [1, null, total - 3, total - 2, total - 1, total];

  return [1, null, current - 1, current, current + 1, null, total];
};

const visiblePages = getVisiblePages(page.currentPage, page.lastPage);
---

<nav aria-label="Pagination" class="mt-16 flex flex-col items-center gap-4">
  <div class="flex items-center gap-2">
    <a
      href={page.url.prev}
      class={`inline-flex h-9 items-center gap-1 rounded-md px-4 text-sm font-medium transition-colors ${
        page.url.prev
          ? "text-foreground hover:bg-muted cursor-pointer"
          : "text-muted-foreground/40 cursor-not-allowed pointer-events-none"
      }`}
    >
      <span class="icon-[ph--caret-left-light] size-4"></span>
      Previous
    </a>

    <div class="flex items-center gap-1.5">
      {
        visiblePages.map((pageNum) =>
          pageNum === null ? (
            <span class="w-9 text-center text-muted-foreground">...</span>
          ) : (
            <a
              href={pageNum === 1 ? "/posts" : `/posts/${pageNum}`}
              class={`inline-flex h-9 w-9 items-center justify-center rounded-md text-sm transition-colors ${
                page.currentPage === pageNum
                  ? "text-primary font-medium border-primary/20 border"
                  : "text-foreground/80 hover:text-foreground hover:bg-muted"
              }`}
            >
              {pageNum}
            </a>
          )
        )
      }
    </div>

    <a
      href={page.url.next}
      class={`inline-flex h-9 items-center gap-1 rounded-md px-4 text-sm font-medium transition-colors ${
        page.url.next
          ? "text-foreground hover:bg-muted cursor-pointer"
          : "text-muted-foreground/40 cursor-not-allowed pointer-events-none"
      }`}
    >
      Next
      <span class="icon-[ph--caret-right-light] size-4"></span>
    </a>
  </div>
</nav>
